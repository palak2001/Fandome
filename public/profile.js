async function getUserProfile(){$("#myInfo").empty(),await auth.onAuthStateChanged(async function(e){console.log(e.uid),await database.ref("users/"+e.uid).once("value",function(e){var n=e.val();console.log(n);let a=document.createElement("div");if(a.className="card",a.style.backgroundColor="transparent",null!=n.image){let e=new Image;e.src=n.image,a.append(e)}let t=document.createElement("input");t.setAttribute("type","file"),t.name="profile_photo",t.placeholder="Upload profile photo";let o=document.createElement("input");o.type="text",o.name="Name",namePlace=null==n.name?"Anonymous":n.name,o.placeholder=namePlace;let l=document.createElement("h6");l.innerHTML="Username: "+n.username;let i=document.createElement("h6");i.innerHTML="Email: "+n.email;let r=document.createElement("button");r.innerHTML="Save",r.addEventListener("click",async function(){await editProfile(o.value,t,n.username,uid)}),a.append(t,o,l,i,r),$("#myInfo").append(a)})})}async function uploadImage(a,t,o){if(null!=a&&null!=a.files&&0<a.files.length){a=a.files[0],console.log(a);let e=firebase.storage().ref("gallery/"+t),n=e.put(a);await n.on("state_changed",async function(e){},async function(e){console.error(e)},async function(){await n.snapshot.ref.getDownloadURL().then(async function(e){console.log("File available at",e);let n=firebase.storage().ref("gallery/"+t),a;await n.getDownloadURL().then(function(e){a=e}),await database.ref("users/"+o).update({image:a})}),window.location.href=window.location.href})}else window.location.href=window.location.href}async function getAllUsers(){console.log("getAllUsers() function is called");let t=[];await database.ref("users").once("value",function(e){e.forEach(function(e){e=e.val();t.push(e.username)})}),getUsers=document.getElementById("allUsers");for(let a=0;a<t.length;a++){let e=document.createElement("li"),n=document.createElement("a");n.textContent=t[a],n.href="profile/"+await getUidByUsername(t[a]),e.appendChild(n),getUsers.append(e)}}async function findUser(){var e=document.getElementById("findUser").value,n=await getUidByUsername(e);let a=document.getElementById("userInfo"),t=document.createElement("a");t.textContent=e,t.href=n,console.log(t),a.append(t)}async function getUsernameByUid(e){let n;return await database.ref("users/"+e).once("value",function(e){e=e.val();n=e.username}),n}async function getUidByUsername(a){let t,o,l;return await firebase.database().ref("users").once("value",function(e){e.forEach(function(e){var n=e.val();n.username==a&&(t=n.email,o=n.name,l=e.key)})}),console.log(l),l}async function editProfile(e,n,a,t){console.log("save working............."),console.log(n),await database.ref("users/"+t).update({name:e}),await uploadImage(n,a,t)}